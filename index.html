<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Le0Flix</title>
<style>
:root {
  --bg1: #1b0836;
  --bg2: #2d0b59;
  --bg3: #000;
}
body {
  margin:0; font-family:system-ui; background:linear-gradient(to bottom,var(--bg1),var(--bg2),var(--bg3)); color:#fff; overflow-x:hidden;
}
header {
  display:flex; align-items:center; justify-content:space-between; padding:15px 20px; position:sticky; top:0; background:var(--bg2); z-index:100;
}
header img { height:100px; cursor:pointer; }
header .buttons { display:flex; gap:15px; align-items:center; }
header .buttons div { cursor:pointer; font-size:18px; }
#search { width:90%; max-width:500px; margin:10px auto; display:block; padding:12px 18px; border-radius:25px; border:none; font-size:16px; }
#grid { display:grid; grid-template-columns:repeat(2,1fr); gap:14px; padding:20px; }
.card { border-radius:14px; overflow:hidden; position:relative; cursor:pointer; background:#111; transition:all 0.3s; }
.card:hover { transform:scale(1.03); }
.card img { width:100%; height:200px; object-fit:cover; }
.card .info { position:absolute; bottom:0; width:100%; padding:6px; font-size:13px; background:linear-gradient(to top,rgba(0,0,0,.8),transparent); display:flex; justify-content:space-between; align-items:center; }
.card .heart { cursor:pointer; font-size:18px; margin-left:5px; }
.card .progress { position:absolute; bottom:0; left:0; height:4px; background:red; width:0%; border-radius:2px; transition:width 0.2s; }
#playerPage { display:none; position:fixed; inset:0; background:#000; z-index:200; flex-direction:column; }
#playerPage video { width:100%; height:100%; object-fit:contain; }
.skeleton { background:linear-gradient(90deg,#222,#333,#222); background-size:200% 100%; animation:shimmer 1.4s infinite; aspect-ratio:2/3; border-radius:14px; }
@keyframes shimmer { 0%{background-position:200%} 100%{background-position:-200%} }
@media(min-width:768px){ #grid { grid-template-columns:repeat(4,1fr); } }
</style>
</head>
<body>

<header>
  <img id="logo" src="https://i.ibb.co/5gT8z3DB/Black-White-Bold-Modern-Studio-Logo-20260102-135638-0000-removebg-preview.png">
  <div class="buttons">
    <div id="favoritesBtn">‚ù§Ô∏è Favoris</div>
    <div id="historyBtn">üìú Historique</div>
  </div>
</header>

<input id="search" placeholder="Rechercher un film...">

<div id="grid"></div>

<div id="playerPage">
  <video id="player" controls playsinline></video>
</div>

<script>
let movies=[], displayed=[], favorites=JSON.parse(localStorage.getItem("favorites")||"[]"), historyList=JSON.parse(localStorage.getItem("history")||"[]"), currentMovie;

// SKELETON
const grid=document.getElementById("grid");
for(let i=0;i<6;i++){ const s=document.createElement("div"); s.className="skeleton"; grid.appendChild(s); }

// FETCH JSON + ANTI CACHE
fetch("movies.json?"+Date.now())
.then(r=>r.json())
.then(data=>{
  movies=data;
  displayed=movies;
  render(displayed);
});

// LOCALSTORAGE PROGRESS
function updateProgress(id, percent){ let prog=JSON.parse(localStorage.getItem("progress")||"{}"); prog[id]=percent; localStorage.setItem("progress",JSON.stringify(prog)); }
function getProgress(id){ let prog=JSON.parse(localStorage.getItem("progress")||"{}"); return prog[id]||0; }

// RENDER
function render(list){
  grid.innerHTML="";
  if(list.length===0){ grid.innerHTML="<div style='text-align:center;padding:50px;color:#ccc;'>Aucun film trouv√©</div>"; return; }
  list.forEach(m=>{
    const c=document.createElement("div");
    c.className="card";
    const percent=getProgress(m.id);
    c.innerHTML=`
      <img src="${m.image}">
      <div class="info">
        <span>${m.titre}</span>
        <span class="heart ${favorites.includes(m.id)?'red':''}">${favorites.includes(m.id)?'‚ù§Ô∏è':'üñ§'}</span>
      </div>
      <div class="progress" style="width:${percent}%"></div>
    `;
    grid.appendChild(c);

    // FAVORI
    const heart=c.querySelector(".heart");
    heart.onclick=e=>{
      e.stopPropagation();
      if(favorites.includes(m.id)) favorites=favorites.filter(f=>f!==m.id); else favorites.push(m.id);
      localStorage.setItem("favorites",JSON.stringify(favorites));
      render(displayed);
    };

    c.onclick=()=>openPlayer(m);
  });
}

// SEARCH
document.getElementById("search").oninput=e=>{
  const q=e.target.value.toLowerCase();
  displayed=movies.filter(m=>m.titre.toLowerCase().includes(q));
  render(displayed);
};

// PLAYER
const playerPage=document.getElementById("playerPage");
const player=document.getElementById("player");
function openPlayer(m){
  currentMovie=m;
  player.src=m.video;
  playerPage.style.display="flex";
  document.getElementById("logo").style.display="none";
  document.getElementById("favoritesBtn").style.display="none";
  document.getElementById("historyBtn").style.display="none";

  if(!historyList.includes(m.id)){
    historyList.push(m.id);
    localStorage.setItem("history",JSON.stringify(historyList));
  }

  player.play();
  const percent=getProgress(m.id);
  if(percent>0){
    player.currentTime=(percent/100)*player.duration;
  }
}

// UPDATE PROGRESS
player.ontimeupdate=()=>{
  if(player.src && currentMovie){
    const percent=Math.floor((player.currentTime/player.duration)*100);
    updateProgress(currentMovie.id,percent);
    const card=Array.from(document.querySelectorAll(".card")).find(c=>c.querySelector(".info span").textContent===currentMovie.titre);
    if(card) card.querySelector(".progress").style.width=percent+"%";
  }
}

// REVENIR ACCUEIL
document.getElementById("logo").onclick=()=>{
  player.pause();
  playerPage.style.display="none";
  document.getElementById("logo").style.display="block";
  document.getElementById("favoritesBtn").style.display="flex";
  document.getElementById("historyBtn").style.display="flex";
  render(displayed);
};

// FAVORIS / HISTORIQUE
document.getElementById("favoritesBtn").onclick=()=>{ displayed=movies.filter(m=>favorites.includes(m.id)); render(displayed); };
document.getElementById("historyBtn").onclick=()=>{ displayed=movies.filter(m=>historyList.includes(m.id)); render(displayed); };

</script>
</body>
</html>
